{
  "hash": "287965aba8ccc76a995159f531a4e9c2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Considering time\"\nformat:\n  html: default\n  revealjs:\n    fontsize: 24px\n    output-file: slides_time.html\n    footer: \"[AES_707](https://petrpajdla.github.io/stat4arch/) *Statistics seminar for archaeologists* | [Time](./time.html)\"\n    chalkboard:\n      theme: whiteboard\n      chalk-effect: 0.0\n  pdf: default\nexecute:\n  echo: true\n  warning: false\n  cache: true\n---\n\n\n\n\n\n## Goals {background-color=\"#FAF1A4\"}\n\n- methods of temporal analysis\n  - calibration of radiocarbon data\n  - working with temporal uncertainties - introduction to the aoristic method\n- R\n  - joining 2 tables\n  - creating a new variable based on condition in different variable\n  - some tips and tricks for your ggplot\n\n## Radiocarbon dating {background-color=\"#B5E2FF\"}\n\n## Evocation\n- What's the difference between _absolute_ dating and _relative_ dating?\n- How the archaeologists estimated absolute dates before invention of the radiocarbon dating?\n- Can you tell other methods of absolute dating?\n\n## How RC dating works\n\n### A very simple introduction\n\n- It is based on measurement of proportion of radioactive 14C in organic material.\n- Plants are absorbing 14C from atmosphere which then continues to animals and humans through food chain.\n- After the dead of the organism the 14C starts to decay, and by measuring proportion of the 14C still in the body and comparing it with the amount of 14C in atmosphere, we can measure __time when the organism died__.\n- Since the amount of the 14C in atmosphere varies during time, we need to calibrate the results with so called \"calibration curve\".\n- Keep in mind that we are not dating a date of creation of the archaeological context, but date of the death of the organism, be it human individual, grain, or a tree.\n\n## \n\n![](./figs/carbon.jpg)\n\nFor more information, see:\n\n- Bayliss, A, and Marshall, P, 2022 [Radiocarbon Dating and Chronological Modelling: Guidelines and Best Practice](https://historicengland.org.uk/images-books/publications/radiocarbon-dating-chronological-modelling/heag312-radiocarbon-dating/) \n- Renfrew, C., & Bahn, P.G. 1998. [Archaeology: theories, methods and practice](https://katalog.muni.cz/Record/MUB01006519482) \n\n\n## Today's dataset\n\n### LASOLES\n\nLet's try to calibrate some radiocarbon data! \n\nWe will do so with the same data as last time, from the LASOLES radiocarbon database of the Czech Republic.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\n\ndf_lasoles <- read.csv(\"./data/LASOLES_14C_database.csv\", sep = \";\")\n\ndf_lasoles$Age14C <- as.numeric(df_lasoles$Age14C)\ndf_lasoles$SD14C <- as.numeric(df_lasoles$SD14C)\n\nhead(df_lasoles[, 1:7], 12)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     ID_Date   Lab_code Laboratory Age14C SD14C    Date_type Delta_13C\n1   CzArch_1  Poz-41673        Poz   3345    30 conv. 14C BP          \n2   CzArch_5      A-215          A   3040    45 conv. 14C BP          \n3   CzArch_6    Bln-102        Bln   6285   100 conv. 14C BP          \n4   CzArch_7   Bln-102a        Bln   6405   100 conv. 14C BP          \n5  CzArch_11   Bln-1165        Bln   4670    80 conv. 14C BP          \n6  CzArch_12   Bln-1166        Bln   4670    80 conv. 14C BP          \n7  CzArch_13   Bln-1167        Bln   2525    80 conv. 14C BP          \n8  CzArch_14 Bln-1167-A        Bln   2440    80 conv. 14C BP          \n9  CzArch_15    Bln-118        Bln    665   100 conv. 14C BP          \n10 CzArch_16   Bln-1244        Bln   4955    80 conv. 14C BP          \n11 CzArch_17   Bln-1396        Bln   4770    60 conv. 14C BP          \n12 CzArch_18 Bln-1396-A        Bln   4775    60 conv. 14C BP          \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n## Quick calibration\n\n- We will use a real radiocarbon date sampled from a Final Eneolihic -- Early Bronze Age site Pavlov u Dolních Věstonic, \"Horní pole\". \n- We will use package `rcarbon` and calibration curve [IntCal20](https://www.cambridge.org/core/journals/radiocarbon/article/intcal20-northern-hemisphere-radiocarbon-age-calibration-curve-055-cal-kbp/83257B63DC3AF9CFA6243F59D7503EFF) \n\n### Details\n\n- uncalibrated date:  **3990**\n- standart deviation: **54**\n\n#### Additional information\n\n- laboratory code: \tErl-4719\n- typochronological datation: Bell Beaker Culture\n- archaeological context: grave\n- sample: human bone\n \n \n## Quick calibration \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"rcarbon\")\nlibrary(rcarbon)\ncal_date <- calibrate(x = 3990, errors = 54, calCurves = \"intcal20\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(cal_date)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  DateID MedianBP OneSigma_BP_1 OneSigma_BP_2 OneSigma_BP_3 TwoSigma_BP_1\n1      1     4464  4565 to 4562  4528 to 4406  4364 to 4360  4783 to 4768\n  TwoSigma_BP_2 TwoSigma_BP_3 TwoSigma_BP_4\n1  4614 to 4596  4583 to 4288  4272 to 4250\n```\n\n\n:::\n:::\n\n\n\n\n\n\nMedian of the calibrated date is __4464 BP__\n\n\n## Quick plot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(cal_date)\n```\n\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-8-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## Improving your plot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(cal_date, calendar = \"BCAD\", HPD = TRUE)\n```\n\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-9-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n- argument `HPD` higlights confidence of the posterior density, by default set to 95% (2 standard deviations)\n\n\n## Why I can't get single BCE number?\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-10-1.pdf)\n:::\n:::\n\n\n\n\n\n## Plotting multiple samples {.scrollable}\n- let's create a subset with samples from our site, dated to the Final Eneolithic and Early Bronze Age and having no dating errors\n- copy and paste this code from our web:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_sample_site <- df_lasoles %>% \n  filter(Civil_parish == \"Pavlov u Dolních Věstonic\" & \n         Site_name == \"Horní pole\" & \n         Age14C > 3500 & \n         Age14C < 5000 & \n         Dating_error == \"n\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncal_dates <- calibrate(x = df_sample_site$Age14C, errors = df_sample_site$SD14C, calCurves = \"intcal20\", ids = df_sample_site$Lab_code) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(summary(cal_dates),4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    DateID MedianBP OneSigma_BP_1 OneSigma_BP_2 OneSigma_BP_3 OneSigma_BP_4\n1 Erl-4709     4240  4383 to 4374  4352 to 4329  4297 to 4150      NA to NA\n2 Erl-4710     4267  4398 to 4372  4353 to 4328  4299 to 4225  4204 to 4155\n3 Erl-4714     4107  4228 to 4202  4156 to 4067  4046 to 3987      NA to NA\n4 Erl-4715     4125  4232 to 4199  4183 to 4167  4159 to 4080  4037 to 3994\n  OneSigma_BP_5 TwoSigma_BP_1 TwoSigma_BP_2 TwoSigma_BP_3 TwoSigma_BP_4\n1      NA to NA  4411 to 4141  4130 to 4091      NA to NA      NA to NA\n2      NA to NA  4412 to 4148  4116 to 4098      NA to NA      NA to NA\n3      NA to NA  4343 to 4338  4292 to 3960  3950 to 3924      NA to NA\n4      NA to NA  4349 to 4332  4295 to 3970  3944 to 3930      NA to NA\n```\n\n\n:::\n:::\n\n\n\n\n## Multiplot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmultiplot(cal_dates, decreasing=TRUE, HPD=TRUE, label.pos=0.9, label.offset=-200,  calendar = \"BCAD\")\n```\n\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-14-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## Radiocarbon dates as proxies for human demography\n\n- in recent years, radiocarbon data are being widely used  for determining relative demography\n- different methods, e.g. summed probability distribution (SPD) or kernel density estimation (KDE)\n\n![SPD, From Kolář, J., Macek, M., Tkáč, P., Novák, D., & Abraham, V. 2022. Long-term demographic trends and spatio-temporal distribution of past human activity in Central Europe: Comparison of archaeological and palaeoecological proxies. Quaternary Science Reviews 297: p.107834](./figs/spd.jpg){fig-width=80%}\n\n\n## RC Dates as proxies for demography\n\n![SPD - model, From Kolář, J., Macek, M., Tkáč, P., Novák, D., & Abraham, V. 2022. Long-term demographic trends and spatio-temporal distribution of past human activity in Central Europe: Comparison of archaeological and palaeoecological proxies. Quaternary Science Reviews 297: p.107834.](./figs/spd_model.jpg)\n\n\n## Where to find more info\nThis [article](https://cran.r-project.org/web/packages/rcarbon/vignettes/rcarbon.html) provides step-by-step instruction for plenty other analyses, e.g. SPD\n\n![](./figs/lekce8_fig1.png)\n\n\n## Other packages for radiocarbon data\n- [oxcAAR](https://cran.r-project.org/web/packages/oxcAAR/vignettes/basic-usage.html) - R interface for [Oxcal](https://c14.arch.ox.ac.uk/)\n\n- [Bchron](https://andrewcparnell.github.io/Bchron/index.html) - for Bayesian modeling\n\n- [c14](https://github.com/joeroe/c14) - package for \"tidy\" workflow with 14C data (in experimental phase) \n\n- [c14bazAAR](https://github.com/ropensci/c14bazAAR) - archive of different open access radiocarbon databases\n\n- [stratigraphr](https://stratigraphr.joeroe.io/) - package for stratigraphy and chronology\n\n\n## Exercise {background-color=\"#B5E2FF\"}\n\n1. Clean your workspace, create a new script in your project folder, load the database [LASOLES](./data/LASOLES_14C_database.csv).\n2. Create a new dataframe with data from burial site *Vedrovice - Široká u lesa*, dated to *Linear Pottery Culture*.\n3. Calibrate all the data and create a multiplot.\n\n**Hints**: ne.lin, filter(), multiplot()\n\n## Working with temporal uncertainties {background-color=\"#B5E2FF\"}\n\n## Problem\n\n\n\n\n\n\n\n\n\n- Imagine you are trying to model intensity of human occupation in longer time period  by quantifing archaeological contexts but you are struggling with the problem how to compare contexts with various accuracy of their dating. \n- E.g. some contexts are dated vaguely to \"neolithic period\" because the only artefact found there was a culturaly insignificant polished axe. And on the contrary, other contexts are dated to shorter periods such as \"Stroked Pottery Culture period\" (_vypíchaná ker._) thanks to finds of recognizable ornamented pottery. \n\n\n## \n\n![](./figs/meme.png){fig-width=80%}\n\n## \n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-16-1.pdf)\n:::\n:::\n\n\n\n\n## Aoristic method\n\n- will help us with overcoming difficulties with temporal uncertainties\n- see [Crema, E.R. 2012](https://link.springer.com/article/10.1007/s10816-011-9122-3) for more details\n\n- what we need:\n  - for every archaeological context we need a typo-chronological datation and start date and end date of each of these datations, such as in example below:\n \n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n  context_number context_dating_AMCR date_start date_end\n1           pit1              ne.lin      -5400    -4801\n2           pit2              neolit      -5400    -4301\n3           pit3              ne.lin      -5300    -4801\n4         grave1              ne.lin      -5300    -4801\n```\n\n\n:::\n:::\n\n\n\n## Joining two tables together\n - for the sake of the simplicity and for these educational purposes, we will work with LASOLES database as if it does not consists of radiocarbon samples but of contexts of these samples dated typo-chronologicaly to various periods\n- but since LASOLES does not have variables with information about start and end date, we will need to get those information from another datase - [datation_mor.csv](./data/datation_mor.csv)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_datations <- read.csv(here(\"datation_mor.csv\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df_datations,4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  kultura date_start date_end\n1  mezoli      -9600    -5401\n2  ne.lin      -5400    -4801\n3   ne-en      -5400    -2001\n4  neolit      -5400    -4301\n```\n\n\n:::\n:::\n\n\n\n\n- now we need to add variables date_start and date_end to dataframe df_lasoles. We will do so by joining the two tables through variables \"kultura\" and \"Contex_dating_AMCR\" by command `right_join`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_lasoles <- df_lasoles %>% \n  right_join(df_datations, by = c(\"Contex_dating_AMCR\" = \"kultura\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_lasoles$date_start <- as.numeric(df_lasoles$date_start)\ndf_lasoles$date_end <- as.numeric(df_lasoles$date_end)\n```\n:::\n\n\n\n- see [documentation](https://dplyr.tidyverse.org/reference/mutate-joins.html) for different types of joins\n\n## Saving your new dataframe\n\nYou can save your new dataframe now so you don't need to join the tables again next time:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv(df_lasoles, file = here(\"df_lasoles2.csv\"), row.names = FALSE)\n```\n:::\n\n\n\n\n## Calculation of the aoristic sum\n\nPackage - `aoristAAR`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!require('devtools')) install.packages('devtools')\n\nlibrary(devtools)\ninstall_github('ISAAKiel/aoristAAR')\n\nlibrary(aoristAAR)\n```\n:::\n\n\n\n\nCalculation:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(aoristAAR)\n\naori <- aorist(df_lasoles, from = \"date_start\", to = \"date_end\", method = \"period_correction\", stepwidth = 1)\n\nhead(aori, 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 x 2\n   date    sum\n  <int>  <dbl>\n1 -9600 0.0217\n2 -9599 0.0217\n3 -9598 0.0217\n4 -9597 0.0217\n```\n\n\n:::\n:::\n\n\n\n\n## Plot\nQuick plot:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot()+\n  geom_line(data = aori, aes(x=date, y=sum))\n```\n\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-26-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## Improving your plot\n\n- command `geom_vline` adds vertical line on coordinates defined by you\n- in this case, we mark -5400 BCE\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot()+\n  geom_line(data = aori, aes(x=date, y=sum))+\n  geom_vline(xintercept = -5400, color = \"red\")\n```\n\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-27-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## But why stop here?\n- lets mark the periods in your plot and divide the x-axis by 1000 years!\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperiods <- c(-9600, -5400, -4300, -2200, -800, -480, -30, 581)\nmarks <- seq(-10000, 1500, by = 1000)\n\nggplot()+\n  geom_vline(xintercept = periods, color = \"red\", linetype = 2)+\n  geom_line(data = aori, aes(x=date, y=sum))+\n  scale_x_continuous(breaks = marks)+ \n  labs(x=\"BCE/AD\", y=\"aoristic sum\")+\n  theme_light()\n```\n\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-28-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n- notice that when we've changed the order of the lines so the later overlaps the earlier\n- for the sake of simplicity, we will ignore the year \"0\" which should not exist\n\n## Grouping areals into broader categories {.scrollable}\nWhat if we want to observe differences in aoristic sum for different site category? For example settlements versus burial sites? \n\n- first, we can check how many different site categories are being used\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(df_lasoles$Site_category_ENG)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"hillfort\"                  \"settlement\"               \n [3] \"unpublished\"               \"large circular enclosure\" \n [5] \"burial ground\"             \"settlement-exp\"           \n [7] \"cave or abri\"              \"extraction site\"          \n [9] \"ritual site\"               \"enclosure\"                \n[11] \"tumuli\"                    \"hoard other\"              \n[13] \"secondary find\"            \"hoard of bronze artefacts\"\n[15] \"single find\"               \"military camp\"            \n[17] \"hoard of ceramic vessels\"  NA                         \n```\n\n\n:::\n:::\n\n\n\n\nThere are too many areals for any usefull visualisation, so we need to group them to broader categories. For example burial grounds and tumuli will be in one category only.\n\n- first step is creating vectors of site categories:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nl_settlements <- c(\"settlement\", \"hillfort\", \"settlement-exp\", \"military camp\", \"large circular enclosure\", \"enclosure\")\nl_burials <- c(\"burial ground\", \"tumuli\")\nl_hoards <- c(\"hoard of a bronze artefacts\", \"hoard other\", \"hoard of ceramic vessels\")\nl_other <- c(\"single find\", \"cave or abri\", \"secondary find\", \"extraction site\", \"unpublished\",\"ritual_site\" )\n```\n:::\n\n\n\n\n\n- then with the help of `mutate` will create a new variable \"new_category\"\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_lasoles <- df_lasoles %>% \n  mutate(new_category = ifelse(Site_category_ENG %in% l_settlements, \"settlements\",\n                ifelse(Site_category_ENG %in% l_burials, \"burials\",\n                       ifelse(Site_category_ENG %in% l_hoards, \"hoards\",\n                              ifelse(Site_category_ENG %in% l_other, \"other\",\n                                     \"no-data\")))))\n```\n:::\n\n\n\n\n## Aoristic for different categories\n\nNow we can create aoristic sum for each new site category. Let's try it for settlements and burials:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_settlements <- df_lasoles %>% \n  filter(new_category == \"settlements\")\ndf_burials <- df_lasoles %>% \n  filter(new_category == \"burials\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naori_settlements <- aorist(df_settlements, from = \"date_start\", to = \"date_end\", method = \"period_correction\", stepwidth = 1)\naori_burials <- aorist(df_burials, from = \"date_start\", to = \"date_end\", method = \"period_correction\", stepwidth = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot()+\n  geom_line(data = aori_settlements, aes(x=date, y=sum), color = \"red\")+\n  geom_line(data = aori_burials, aes(x=date, y=sum), color = \"blue\")+\n  scale_x_continuous(breaks = marks)+ \n  theme_light()\n```\n\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-34-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## Easy subseting\n- you can create similar subsets without creating a new variable:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nl_enclosures <- c(\"large circular enclosure\", \"enclosure\")\n\ndf_enclosures <- df_lasoles %>% \n  filter(Site_category_ENG %in% l_enclosures)\n\naori_encl <- aorist(df_enclosures, from = \"date_start\", to = \"date_end\", method = \"period_correction\", stepwidth = 1)\n\nggplot()+\n  geom_line(data = aori_encl, aes(x=date, y=sum))\n```\n\n::: {.cell-output-display}\n![](time_files/figure-pdf/unnamed-chunk-35-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n## Exercise\n1. clean your workspace, create new script, load either the new lasoles table (with end and start dates) or the old one, but then join it with datation table\n2. create a dataframe of fortificated areas, consisting of hillforts, elevated settlements (settlement-exp) and military camps\n3. calculate an aoristic sum for these fortificated areas and show it in ggplot\n4. add marks to your ggplot visualizing the start and the end of the Iron age period (-800 and -21 BCE)\n5. create a map of those fortified areas in the Czech republic (you will need to create a `sf` file and load \"republika\" from `RCzechia`)\n6. create the same map, but only in Olomoucký kraj\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}