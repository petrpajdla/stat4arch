<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>stat4arch - Considering time</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">stat4arch</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Course overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html"> <i class="bi bi-calendar4" role="img">
</i> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-topics" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Topics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-topics">    
        <li>
    <a class="dropdown-item" href="../../lect/w01/intro.html">
 <span class="dropdown-text">Course introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lect/w01/tidy.html">
 <span class="dropdown-text">Tidy data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lect/w02/intro2r.html">
 <span class="dropdown-text">Coding in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lect/w03/distribs.html">
 <span class="dropdown-text">Summaries and visualization of distributions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lect/w04/rels.html">
 <span class="dropdown-text">Summaries and visualization of relationships</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lect/w05/norm.html">
 <span class="dropdown-text">Normal distribution</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lect/w05/dplyr.html">
 <span class="dropdown-text">Data manipulation with dplyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lect/w07/space.html">
 <span class="dropdown-text">Considering space</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../project.html"> <i class="bi bi-file-earmark-code" role="img">
</i> 
<span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> <i class="bi bi-gear" role="img">
</i> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../kit.html"> <i class="bi bi-patch-question" role="img">
</i> 
<span class="menu-text">Survival kit</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#goals" id="toc-goals" class="nav-link active" data-scroll-target="#goals">Goals</a></li>
  <li><a href="#radiocarbon-dating" id="toc-radiocarbon-dating" class="nav-link" data-scroll-target="#radiocarbon-dating">Radiocarbon dating</a></li>
  <li><a href="#evocation" id="toc-evocation" class="nav-link" data-scroll-target="#evocation">Evocation</a></li>
  <li><a href="#how-rc-dating-works" id="toc-how-rc-dating-works" class="nav-link" data-scroll-target="#how-rc-dating-works">How RC dating works</a>
  <ul class="collapse">
  <li><a href="#a-very-simple-introduction" id="toc-a-very-simple-introduction" class="nav-link" data-scroll-target="#a-very-simple-introduction">A very simple introduction</a></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#todays-dataset" id="toc-todays-dataset" class="nav-link" data-scroll-target="#todays-dataset">Today’s dataset</a>
  <ul class="collapse">
  <li><a href="#lasoles" id="toc-lasoles" class="nav-link" data-scroll-target="#lasoles">LASOLES</a></li>
  </ul></li>
  <li><a href="#quick-calibration" id="toc-quick-calibration" class="nav-link" data-scroll-target="#quick-calibration">Quick calibration</a>
  <ul class="collapse">
  <li><a href="#details" id="toc-details" class="nav-link" data-scroll-target="#details">Details</a></li>
  </ul></li>
  <li><a href="#quick-calibration-1" id="toc-quick-calibration-1" class="nav-link" data-scroll-target="#quick-calibration-1">Quick calibration</a></li>
  <li><a href="#quick-plot" id="toc-quick-plot" class="nav-link" data-scroll-target="#quick-plot">Quick plot</a></li>
  <li><a href="#improving-your-plot" id="toc-improving-your-plot" class="nav-link" data-scroll-target="#improving-your-plot">Improving your plot</a></li>
  <li><a href="#why-i-cant-get-single-bce-number" id="toc-why-i-cant-get-single-bce-number" class="nav-link" data-scroll-target="#why-i-cant-get-single-bce-number">Why I can’t get single BCE number?</a></li>
  <li><a href="#plotting-multiple-samples" id="toc-plotting-multiple-samples" class="nav-link" data-scroll-target="#plotting-multiple-samples">Plotting multiple samples</a></li>
  <li><a href="#multiplot" id="toc-multiplot" class="nav-link" data-scroll-target="#multiplot">Multiplot</a></li>
  <li><a href="#radiocarbon-dates-as-proxies-for-human-demography" id="toc-radiocarbon-dates-as-proxies-for-human-demography" class="nav-link" data-scroll-target="#radiocarbon-dates-as-proxies-for-human-demography">Radiocarbon dates as proxies for human demography</a></li>
  <li><a href="#rc-dates-as-proxies-for-demography" id="toc-rc-dates-as-proxies-for-demography" class="nav-link" data-scroll-target="#rc-dates-as-proxies-for-demography">RC Dates as proxies for demography</a></li>
  <li><a href="#where-to-find-more-info" id="toc-where-to-find-more-info" class="nav-link" data-scroll-target="#where-to-find-more-info">Where to find more info</a></li>
  <li><a href="#other-packages-for-radiocarbon-data" id="toc-other-packages-for-radiocarbon-data" class="nav-link" data-scroll-target="#other-packages-for-radiocarbon-data">Other packages for radiocarbon data</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#working-with-temporal-uncertainties" id="toc-working-with-temporal-uncertainties" class="nav-link" data-scroll-target="#working-with-temporal-uncertainties">Working with temporal uncertainties</a></li>
  <li><a href="#problem" id="toc-problem" class="nav-link" data-scroll-target="#problem">Problem</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#aoristic-method" id="toc-aoristic-method" class="nav-link" data-scroll-target="#aoristic-method">Aoristic method</a></li>
  <li><a href="#joining-two-tables-together" id="toc-joining-two-tables-together" class="nav-link" data-scroll-target="#joining-two-tables-together">Joining two tables together</a></li>
  <li><a href="#saving-your-new-dataframe" id="toc-saving-your-new-dataframe" class="nav-link" data-scroll-target="#saving-your-new-dataframe">Saving your new dataframe</a></li>
  <li><a href="#calculation-of-the-aoristic-sum" id="toc-calculation-of-the-aoristic-sum" class="nav-link" data-scroll-target="#calculation-of-the-aoristic-sum">Calculation of the aoristic sum</a></li>
  <li><a href="#plot" id="toc-plot" class="nav-link" data-scroll-target="#plot">Plot</a></li>
  <li><a href="#improving-your-plot-1" id="toc-improving-your-plot-1" class="nav-link" data-scroll-target="#improving-your-plot-1">Improving your plot</a></li>
  <li><a href="#but-why-stop-here" id="toc-but-why-stop-here" class="nav-link" data-scroll-target="#but-why-stop-here">But why stop here?</a></li>
  <li><a href="#grouping-areals-into-broader-categories" id="toc-grouping-areals-into-broader-categories" class="nav-link" data-scroll-target="#grouping-areals-into-broader-categories">Grouping areals into broader categories</a></li>
  <li><a href="#aoristic-for-different-categories" id="toc-aoristic-for-different-categories" class="nav-link" data-scroll-target="#aoristic-for-different-categories">Aoristic for different categories</a></li>
  <li><a href="#easy-subseting" id="toc-easy-subseting" class="nav-link" data-scroll-target="#easy-subseting">Easy subseting</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/petrpajdla/stat4arch/blob/main/lect/w08/time.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/petrpajdla/stat4arch/edit/main/lect/w08/time.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/petrpajdla/stat4arch/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="slides_time.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="time.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Considering time</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="goals" class="level2" data-background-color="#FAF1A4">
<h2 data-background-color="#FAF1A4" class="anchored" data-anchor-id="goals">Goals</h2>
<ul>
<li>methods of temporal analysis
<ul>
<li>calibration of radiocarbon data</li>
<li>working with temporal uncertainties - introduction to the aoristic method</li>
</ul></li>
<li>R
<ul>
<li>joining 2 tables</li>
<li>creating a new variable based on condition in different variable</li>
<li>some tips and tricks for your ggplot</li>
</ul></li>
</ul>
</section>
<section id="radiocarbon-dating" class="level2" data-background-color="#B5E2FF">
<h2 data-background-color="#B5E2FF" class="anchored" data-anchor-id="radiocarbon-dating">Radiocarbon dating</h2>
</section>
<section id="evocation" class="level2">
<h2 class="anchored" data-anchor-id="evocation">Evocation</h2>
<ul>
<li>What’s the difference between <em>absolute</em> dating and <em>relative</em> dating?</li>
<li>How the archaeologists estimated absolute dates before invention of the radiocarbon dating?</li>
<li>Can you tell other methods of absolute dating?</li>
</ul>
</section>
<section id="how-rc-dating-works" class="level2">
<h2 class="anchored" data-anchor-id="how-rc-dating-works">How RC dating works</h2>
<section id="a-very-simple-introduction" class="level3">
<h3 class="anchored" data-anchor-id="a-very-simple-introduction">A very simple introduction</h3>
<ul>
<li>It is based on measurement of proportion of radioactive 14C in organic material.</li>
<li>Plants are absorbing 14C from atmosphere which then continues to animals and humans through food chain.</li>
<li>After the dead of the organism the 14C starts to decay, and by measuring proportion of the 14C still in the body and comparing it with the amount of 14C in atmosphere, we can measure <strong>time when the organism died</strong>.</li>
<li>Since the amount of the 14C in atmosphere varies during time, we need to calibrate the results with so called “calibration curve”.</li>
<li>Keep in mind that we are not dating a date of creation of the archaeological context, but date of the death of the organism, be it human individual, grain, or a tree.</li>
</ul>
</section>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p><img src="./figs/carbon.jpg" class="img-fluid"></p>
<p>For more information, see:</p>
<ul>
<li>Bayliss, A, and Marshall, P, 2022 <a href="https://historicengland.org.uk/images-books/publications/radiocarbon-dating-chronological-modelling/heag312-radiocarbon-dating/">Radiocarbon Dating and Chronological Modelling: Guidelines and Best Practice</a></li>
<li>Renfrew, C., &amp; Bahn, P.G. 1998. <a href="https://katalog.muni.cz/Record/MUB01006519482">Archaeology: theories, methods and practice</a></li>
</ul>
</section>
<section id="todays-dataset" class="level2">
<h2 class="anchored" data-anchor-id="todays-dataset">Today’s dataset</h2>
<section id="lasoles" class="level3">
<h3 class="anchored" data-anchor-id="lasoles">LASOLES</h3>
<p>Let’s try to calibrate some radiocarbon data!</p>
<p>We will do so with the same data as last time, from the LASOLES radiocarbon database of the Czech Republic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>df_lasoles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/LASOLES_14C_database.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>df_lasoles<span class="sc">$</span>Age14C <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_lasoles<span class="sc">$</span>Age14C)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>df_lasoles<span class="sc">$</span>SD14C <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_lasoles<span class="sc">$</span>SD14C)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_lasoles[, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>], <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     ID_Date   Lab_code Laboratory Age14C SD14C    Date_type Delta_13C
1   CzArch_1  Poz-41673        Poz   3345    30 conv. 14C BP          
2   CzArch_5      A-215          A   3040    45 conv. 14C BP          
3   CzArch_6    Bln-102        Bln   6285   100 conv. 14C BP          
4   CzArch_7   Bln-102a        Bln   6405   100 conv. 14C BP          
5  CzArch_11   Bln-1165        Bln   4670    80 conv. 14C BP          
6  CzArch_12   Bln-1166        Bln   4670    80 conv. 14C BP          
7  CzArch_13   Bln-1167        Bln   2525    80 conv. 14C BP          
8  CzArch_14 Bln-1167-A        Bln   2440    80 conv. 14C BP          
9  CzArch_15    Bln-118        Bln    665   100 conv. 14C BP          
10 CzArch_16   Bln-1244        Bln   4955    80 conv. 14C BP          
11 CzArch_17   Bln-1396        Bln   4770    60 conv. 14C BP          
12 CzArch_18 Bln-1396-A        Bln   4775    60 conv. 14C BP          </code></pre>
</div>
</div>
</section>
</section>
<section id="quick-calibration" class="level2">
<h2 class="anchored" data-anchor-id="quick-calibration">Quick calibration</h2>
<ul>
<li>We will use a real radiocarbon date sampled from a Final Eneolihic – Early Bronze Age site Pavlov u Dolních Věstonic, “Horní pole”.</li>
<li>We will use package <code>rcarbon</code> and calibration curve <a href="https://www.cambridge.org/core/journals/radiocarbon/article/intcal20-northern-hemisphere-radiocarbon-age-calibration-curve-055-cal-kbp/83257B63DC3AF9CFA6243F59D7503EFF">IntCal20</a></li>
</ul>
<section id="details" class="level3">
<h3 class="anchored" data-anchor-id="details">Details</h3>
<ul>
<li>uncalibrated date: <strong>3990</strong></li>
<li>standart deviation: <strong>54</strong></li>
</ul>
<section id="additional-information" class="level4">
<h4 class="anchored" data-anchor-id="additional-information">Additional information</h4>
<ul>
<li>laboratory code: Erl-4719</li>
<li>typochronological datation: Bell Beaker Culture</li>
<li>archaeological context: grave</li>
<li>sample: human bone</li>
</ul>
</section>
</section>
</section>
<section id="quick-calibration-1" class="level2">
<h2 class="anchored" data-anchor-id="quick-calibration-1">Quick calibration</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("rcarbon")</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rcarbon)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cal_date <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(<span class="at">x =</span> <span class="dv">3990</span>, <span class="at">errors =</span> <span class="dv">54</span>, <span class="at">calCurves =</span> <span class="st">"intcal20"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cal_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  DateID MedianBP OneSigma_BP_1 OneSigma_BP_2 OneSigma_BP_3 TwoSigma_BP_1
1      1     4464  4565 to 4562  4528 to 4406  4364 to 4360  4783 to 4768
  TwoSigma_BP_2 TwoSigma_BP_3 TwoSigma_BP_4
1  4614 to 4596  4583 to 4288  4272 to 4250</code></pre>
</div>
</div>
<p>Median of the calibrated date is <strong>4464 BP</strong></p>
</section>
<section id="quick-plot" class="level2">
<h2 class="anchored" data-anchor-id="quick-plot">Quick plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cal_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="improving-your-plot" class="level2">
<h2 class="anchored" data-anchor-id="improving-your-plot">Improving your plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cal_date, <span class="at">calendar =</span> <span class="st">"BCAD"</span>, <span class="at">HPD =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>argument <code>HPD</code> higlights confidence of the posterior density, by default set to 95% (2 standard deviations)</li>
</ul>
</section>
<section id="why-i-cant-get-single-bce-number" class="level2">
<h2 class="anchored" data-anchor-id="why-i-cant-get-single-bce-number">Why I can’t get single BCE number?</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-multiple-samples" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="plotting-multiple-samples">Plotting multiple samples</h2>
<ul>
<li>let’s create a subset with samples from our site, dated to the Final Eneolithic and Early Bronze Age and having no dating errors</li>
<li>copy and paste this code from our web:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_sample_site <span class="ot">&lt;-</span> df_lasoles <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Civil_parish <span class="sc">==</span> <span class="st">"Pavlov u Dolních Věstonic"</span> <span class="sc">&amp;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>         Site_name <span class="sc">==</span> <span class="st">"Horní pole"</span> <span class="sc">&amp;</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>         Age14C <span class="sc">&gt;</span> <span class="dv">3500</span> <span class="sc">&amp;</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>         Age14C <span class="sc">&lt;</span> <span class="dv">5000</span> <span class="sc">&amp;</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>         Dating_error <span class="sc">==</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>cal_dates <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(<span class="at">x =</span> df_sample_site<span class="sc">$</span>Age14C, <span class="at">errors =</span> df_sample_site<span class="sc">$</span>SD14C, <span class="at">calCurves =</span> <span class="st">"intcal20"</span>, <span class="at">ids =</span> df_sample_site<span class="sc">$</span>Lab_code) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(cal_dates),<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    DateID MedianBP OneSigma_BP_1 OneSigma_BP_2 OneSigma_BP_3 OneSigma_BP_4
1 Erl-4709     4240  4383 to 4374  4352 to 4329  4297 to 4150      NA to NA
2 Erl-4710     4267  4398 to 4372  4353 to 4328  4299 to 4225  4204 to 4155
3 Erl-4714     4107  4228 to 4202  4156 to 4067  4046 to 3987      NA to NA
4 Erl-4715     4125  4232 to 4199  4183 to 4167  4159 to 4080  4037 to 3994
  OneSigma_BP_5 TwoSigma_BP_1 TwoSigma_BP_2 TwoSigma_BP_3 TwoSigma_BP_4
1      NA to NA  4411 to 4141  4130 to 4091      NA to NA      NA to NA
2      NA to NA  4412 to 4148  4116 to 4098      NA to NA      NA to NA
3      NA to NA  4343 to 4338  4292 to 3960  3950 to 3924      NA to NA
4      NA to NA  4349 to 4332  4295 to 3970  3944 to 3930      NA to NA</code></pre>
</div>
</div>
</section>
<section id="multiplot" class="level2">
<h2 class="anchored" data-anchor-id="multiplot">Multiplot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(cal_dates, <span class="at">decreasing=</span><span class="cn">TRUE</span>, <span class="at">HPD=</span><span class="cn">TRUE</span>, <span class="at">label.pos=</span><span class="fl">0.9</span>, <span class="at">label.offset=</span><span class="sc">-</span><span class="dv">200</span>,  <span class="at">calendar =</span> <span class="st">"BCAD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="radiocarbon-dates-as-proxies-for-human-demography" class="level2">
<h2 class="anchored" data-anchor-id="radiocarbon-dates-as-proxies-for-human-demography">Radiocarbon dates as proxies for human demography</h2>
<ul>
<li>in recent years, radiocarbon data are being widely used for determining relative demography</li>
<li>different methods, e.g.&nbsp;summed probability distribution (SPD) or kernel density estimation (KDE)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/spd.jpg" class="img-fluid figure-img"></p>
<figcaption>SPD, From Kolář, J., Macek, M., Tkáč, P., Novák, D., &amp; Abraham, V. 2022. Long-term demographic trends and spatio-temporal distribution of past human activity in Central Europe: Comparison of archaeological and palaeoecological proxies. Quaternary Science Reviews 297: p.107834</figcaption>
</figure>
</div>
</section>
<section id="rc-dates-as-proxies-for-demography" class="level2">
<h2 class="anchored" data-anchor-id="rc-dates-as-proxies-for-demography">RC Dates as proxies for demography</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/spd_model.jpg" class="img-fluid figure-img"></p>
<figcaption>SPD - model, From Kolář, J., Macek, M., Tkáč, P., Novák, D., &amp; Abraham, V. 2022. Long-term demographic trends and spatio-temporal distribution of past human activity in Central Europe: Comparison of archaeological and palaeoecological proxies. Quaternary Science Reviews 297: p.107834.</figcaption>
</figure>
</div>
</section>
<section id="where-to-find-more-info" class="level2">
<h2 class="anchored" data-anchor-id="where-to-find-more-info">Where to find more info</h2>
<p>This <a href="https://cran.r-project.org/web/packages/rcarbon/vignettes/rcarbon.html">article</a> provides step-by-step instruction for plenty other analyses, e.g.&nbsp;SPD</p>
<p><img src="./figs/lekce8_fig1.png" class="img-fluid"></p>
</section>
<section id="other-packages-for-radiocarbon-data" class="level2">
<h2 class="anchored" data-anchor-id="other-packages-for-radiocarbon-data">Other packages for radiocarbon data</h2>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/oxcAAR/vignettes/basic-usage.html">oxcAAR</a> - R interface for <a href="https://c14.arch.ox.ac.uk/">Oxcal</a></p></li>
<li><p><a href="https://andrewcparnell.github.io/Bchron/index.html">Bchron</a> - for Bayesian modeling</p></li>
<li><p><a href="https://github.com/joeroe/c14">c14</a> - package for “tidy” workflow with 14C data (in experimental phase)</p></li>
<li><p><a href="https://github.com/ropensci/c14bazAAR">c14bazAAR</a> - archive of different open access radiocarbon databases</p></li>
<li><p><a href="https://stratigraphr.joeroe.io/">stratigraphr</a> - package for stratigraphy and chronology</p></li>
</ul>
</section>
<section id="exercise" class="level2" data-background-color="#B5E2FF">
<h2 data-background-color="#B5E2FF" class="anchored" data-anchor-id="exercise">Exercise</h2>
<ol type="1">
<li>Clean your workspace, create a new script in your project folder, load the database <a href="./data/LASOLES_14C_database.csv">LASOLES</a>.</li>
<li>Create a new dataframe with data from burial site <em>Vedrovice - Široká u lesa</em>, dated to <em>Linear Pottery Culture</em>.</li>
<li>Calibrate all the data and create a multiplot.</li>
</ol>
<p><strong>Hints</strong>: ne.lin, filter(), multiplot()</p>
</section>
<section id="working-with-temporal-uncertainties" class="level2" data-background-color="#B5E2FF">
<h2 data-background-color="#B5E2FF" class="anchored" data-anchor-id="working-with-temporal-uncertainties">Working with temporal uncertainties</h2>
</section>
<section id="problem" class="level2">
<h2 class="anchored" data-anchor-id="problem">Problem</h2>
<ul>
<li>Imagine you are trying to model intensity of human occupation in longer time period by quantifing archaeological contexts but you are struggling with the problem how to compare contexts with various accuracy of their dating.</li>
<li>E.g. some contexts are dated vaguely to “neolithic period” because the only artefact found there was a culturaly insignificant polished axe. And on the contrary, other contexts are dated to shorter periods such as “Stroked Pottery Culture period” (<em>vypíchaná ker.</em>) thanks to finds of recognizable ornamented pottery.</li>
</ul>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<p><img src="./figs/meme.png" class="img-fluid" data-fig-width="80%"></p>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="aoristic-method" class="level2">
<h2 class="anchored" data-anchor-id="aoristic-method">Aoristic method</h2>
<ul>
<li><p>will help us with overcoming difficulties with temporal uncertainties</p></li>
<li><p>see <a href="https://link.springer.com/article/10.1007/s10816-011-9122-3">Crema, E.R. 2012</a> for more details</p></li>
<li><p>what we need:</p>
<ul>
<li>for every archaeological context we need a typo-chronological datation and start date and end date of each of these datations, such as in example below:</li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  context_number context_dating_AMCR date_start date_end
1           pit1              ne.lin      -5400    -4801
2           pit2              neolit      -5400    -4301
3           pit3              ne.lin      -5300    -4801
4         grave1              ne.lin      -5300    -4801</code></pre>
</div>
</div>
</section>
<section id="joining-two-tables-together" class="level2">
<h2 class="anchored" data-anchor-id="joining-two-tables-together">Joining two tables together</h2>
<ul>
<li>for the sake of the simplicity and for these educational purposes, we will work with LASOLES database as if it does not consists of radiocarbon samples but of contexts of these samples dated typo-chronologicaly to various periods</li>
<li>but since LASOLES does not have variables with information about start and end date, we will need to get those information from another datase - <a href="./data/datation_mor.csv">datation_mor.csv</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_datations <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"datation_mor.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_datations,<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  kultura date_start date_end
1  mezoli      -9600    -5401
2  ne.lin      -5400    -4801
3   ne-en      -5400    -2001
4  neolit      -5400    -4301</code></pre>
</div>
</div>
<ul>
<li>now we need to add variables date_start and date_end to dataframe df_lasoles. We will do so by joining the two tables through variables “kultura” and “Contex_dating_AMCR” by command <code>right_join</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_lasoles <span class="ot">&lt;-</span> df_lasoles <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(df_datations, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Contex_dating_AMCR"</span> <span class="ot">=</span> <span class="st">"kultura"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_lasoles<span class="sc">$</span>date_start <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_lasoles<span class="sc">$</span>date_start)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df_lasoles<span class="sc">$</span>date_end <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_lasoles<span class="sc">$</span>date_end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>see <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">documentation</a> for different types of joins</li>
</ul>
</section>
<section id="saving-your-new-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="saving-your-new-dataframe">Saving your new dataframe</h2>
<p>You can save your new dataframe now so you don’t need to join the tables again next time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_lasoles, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"df_lasoles2.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculation-of-the-aoristic-sum" class="level2">
<h2 class="anchored" data-anchor-id="calculation-of-the-aoristic-sum">Calculation of the aoristic sum</h2>
<p>Package - <code>aoristAAR</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">'devtools'</span>)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">'ISAAKiel/aoristAAR'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aoristAAR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aoristAAR)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>aori <span class="ot">&lt;-</span> <span class="fu">aorist</span>(df_lasoles, <span class="at">from =</span> <span class="st">"date_start"</span>, <span class="at">to =</span> <span class="st">"date_end"</span>, <span class="at">method =</span> <span class="st">"period_correction"</span>, <span class="at">stepwidth =</span> <span class="dv">1</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aori, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
   date    sum
  &lt;int&gt;  &lt;dbl&gt;
1 -9600 0.0217
2 -9599 0.0217
3 -9598 0.0217
4 -9597 0.0217</code></pre>
</div>
</div>
</section>
<section id="plot" class="level2">
<h2 class="anchored" data-anchor-id="plot">Plot</h2>
<p>Quick plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> aori, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="improving-your-plot-1" class="level2">
<h2 class="anchored" data-anchor-id="improving-your-plot-1">Improving your plot</h2>
<ul>
<li>command <code>geom_vline</code> adds vertical line on coordinates defined by you</li>
<li>in this case, we mark -5400 BCE</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> aori, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum))<span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="dv">5400</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="but-why-stop-here" class="level2">
<h2 class="anchored" data-anchor-id="but-why-stop-here">But why stop here?</h2>
<ul>
<li>lets mark the periods in your plot and divide the x-axis by 1000 years!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>periods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">9600</span>, <span class="sc">-</span><span class="dv">5400</span>, <span class="sc">-</span><span class="dv">4300</span>, <span class="sc">-</span><span class="dv">2200</span>, <span class="sc">-</span><span class="dv">800</span>, <span class="sc">-</span><span class="dv">480</span>, <span class="sc">-</span><span class="dv">30</span>, <span class="dv">581</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>marks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10000</span>, <span class="dv">1500</span>, <span class="at">by =</span> <span class="dv">1000</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> periods, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> aori, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum))<span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> marks)<span class="sc">+</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"BCE/AD"</span>, <span class="at">y=</span><span class="st">"aoristic sum"</span>)<span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>notice that when we’ve changed the order of the lines so the later overlaps the earlier</li>
<li>for the sake of simplicity, we will ignore the year “0” which should not exist</li>
</ul>
</section>
<section id="grouping-areals-into-broader-categories" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="grouping-areals-into-broader-categories">Grouping areals into broader categories</h2>
<p>What if we want to observe differences in aoristic sum for different site category? For example settlements versus burial sites?</p>
<ul>
<li>first, we can check how many different site categories are being used</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df_lasoles<span class="sc">$</span>Site_category_ENG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "hillfort"                  "settlement"               
 [3] "unpublished"               "large circular enclosure" 
 [5] "burial ground"             "settlement-exp"           
 [7] "cave or abri"              "extraction site"          
 [9] "ritual site"               "enclosure"                
[11] "tumuli"                    "hoard other"              
[13] "secondary find"            "hoard of bronze artefacts"
[15] "single find"               "military camp"            
[17] "hoard of ceramic vessels"  NA                         </code></pre>
</div>
</div>
<p>There are too many areals for any usefull visualisation, so we need to group them to broader categories. For example burial grounds and tumuli will be in one category only.</p>
<ul>
<li>first step is creating vectors of site categories:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>l_settlements <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"settlement"</span>, <span class="st">"hillfort"</span>, <span class="st">"settlement-exp"</span>, <span class="st">"military camp"</span>, <span class="st">"large circular enclosure"</span>, <span class="st">"enclosure"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>l_burials <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"burial ground"</span>, <span class="st">"tumuli"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>l_hoards <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hoard of a bronze artefacts"</span>, <span class="st">"hoard other"</span>, <span class="st">"hoard of ceramic vessels"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>l_other <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"single find"</span>, <span class="st">"cave or abri"</span>, <span class="st">"secondary find"</span>, <span class="st">"extraction site"</span>, <span class="st">"unpublished"</span>,<span class="st">"ritual_site"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>then with the help of <code>mutate</code> will create a new variable “new_category”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df_lasoles <span class="ot">&lt;-</span> df_lasoles <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_category =</span> <span class="fu">ifelse</span>(Site_category_ENG <span class="sc">%in%</span> l_settlements, <span class="st">"settlements"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(Site_category_ENG <span class="sc">%in%</span> l_burials, <span class="st">"burials"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(Site_category_ENG <span class="sc">%in%</span> l_hoards, <span class="st">"hoards"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(Site_category_ENG <span class="sc">%in%</span> l_other, <span class="st">"other"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"no-data"</span>)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aoristic-for-different-categories" class="level2">
<h2 class="anchored" data-anchor-id="aoristic-for-different-categories">Aoristic for different categories</h2>
<p>Now we can create aoristic sum for each new site category. Let’s try it for settlements and burials:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df_settlements <span class="ot">&lt;-</span> df_lasoles <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(new_category <span class="sc">==</span> <span class="st">"settlements"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>df_burials <span class="ot">&lt;-</span> df_lasoles <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(new_category <span class="sc">==</span> <span class="st">"burials"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>aori_settlements <span class="ot">&lt;-</span> <span class="fu">aorist</span>(df_settlements, <span class="at">from =</span> <span class="st">"date_start"</span>, <span class="at">to =</span> <span class="st">"date_end"</span>, <span class="at">method =</span> <span class="st">"period_correction"</span>, <span class="at">stepwidth =</span> <span class="dv">1</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>aori_burials <span class="ot">&lt;-</span> <span class="fu">aorist</span>(df_burials, <span class="at">from =</span> <span class="st">"date_start"</span>, <span class="at">to =</span> <span class="st">"date_end"</span>, <span class="at">method =</span> <span class="st">"period_correction"</span>, <span class="at">stepwidth =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> aori_settlements, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum), <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> aori_burials, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum), <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> marks)<span class="sc">+</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="easy-subseting" class="level2">
<h2 class="anchored" data-anchor-id="easy-subseting">Easy subseting</h2>
<ul>
<li>you can create similar subsets without creating a new variable:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>l_enclosures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"large circular enclosure"</span>, <span class="st">"enclosure"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df_enclosures <span class="ot">&lt;-</span> df_lasoles <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Site_category_ENG <span class="sc">%in%</span> l_enclosures)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>aori_encl <span class="ot">&lt;-</span> <span class="fu">aorist</span>(df_enclosures, <span class="at">from =</span> <span class="st">"date_start"</span>, <span class="at">to =</span> <span class="st">"date_end"</span>, <span class="at">method =</span> <span class="st">"period_correction"</span>, <span class="at">stepwidth =</span> <span class="dv">1</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> aori_encl, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="time_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercise-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1">Exercise</h2>
<ol type="1">
<li>clean your workspace, create new script, load either the new lasoles table (with end and start dates) or the old one, but then join it with datation table</li>
<li>create a dataframe of fortificated areas, consisting of hillforts, elevated settlements (settlement-exp) and military camps</li>
<li>calculate an aoristic sum for these fortificated areas and show it in ggplot</li>
<li>add marks to your ggplot visualizing the start and the end of the Iron age period (-800 and -21 BCE)</li>
<li>create a map of those fortified areas in the Czech republic (you will need to create a <code>sf</code> file and load “republika” from <code>RCzechia</code>)</li>
<li>create the same map, but only in Olomoucký kraj</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://quarto.org/">
<p>Build with quarto.</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/petrpajdla/stat4arch/blob/main/lect/w08/time.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/petrpajdla/stat4arch/edit/main/lect/w08/time.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/petrpajdla/stat4arch/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/petrpajdla/stat4arch/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>